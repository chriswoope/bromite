From: Daniel Micay <danielmicay@gmail.com>
Date: Thu, 4 Jul 2019 19:08:52 -0400
Subject: Disable media router and remoting by default

---
 .../media/router/media_router_feature.cc      | 30 +------------------
 chrome/browser/profiles/profile.cc            |  2 +-
 chrome/browser/profiles/profile_impl.cc       |  2 +-
 3 files changed, 3 insertions(+), 31 deletions(-)

diff --git a/chrome/browser/media/router/media_router_feature.cc b/chrome/browser/media/router/media_router_feature.cc
--- a/chrome/browser/media/router/media_router_feature.cc
+++ b/chrome/browser/media/router/media_router_feature.cc
@@ -38,12 +38,6 @@ const base::Feature kAllowAllSitesToInitiateMirroring{
 #endif  // !defined(OS_ANDROID)
 
 namespace {
-const PrefService::Preference* GetMediaRouterPref(
-    content::BrowserContext* context) {
-  return user_prefs::UserPrefs::Get(context)->FindPreference(
-      ::prefs::kEnableMediaRouter);
-}
-
 base::flat_map<content::BrowserContext*, bool>& GetStoredPrefValues() {
   static base::NoDestructor<base::flat_map<content::BrowserContext*, bool>>
       stored_pref_values;
@@ -57,29 +51,7 @@ void ClearMediaRouterStoredPrefsForTesting() {
 }
 
 bool MediaRouterEnabled(content::BrowserContext* context) {
-#if !defined(OS_ANDROID)
-  if (!base::FeatureList::IsEnabled(kMediaRouter))
-    return false;
-#endif  // !defined(OS_ANDROID)
-
-  // If the Media Router was already enabled or disabled for |context|, then it
-  // must remain so.  The Media Router does not support dynamic
-  // enabling/disabling.
-  base::flat_map<content::BrowserContext*, bool>& pref_values =
-      GetStoredPrefValues();
-  auto const it = pref_values.find(context);
-  if (it != pref_values.end())
-    return it->second;
-
-  // Check the enterprise policy.
-  const PrefService::Preference* pref = GetMediaRouterPref(context);
-  if (pref->IsManaged() && !pref->IsDefaultValue()) {
-    CHECK(pref->GetValue()->is_bool());
-    bool allowed = pref->GetValue()->GetBool();
-    pref_values.insert(std::make_pair(context, allowed));
-    return allowed;
-  }
-  return true;
+  return false;
 }
 
 #if !defined(OS_ANDROID)
diff --git a/chrome/browser/profiles/profile.cc b/chrome/browser/profiles/profile.cc
--- a/chrome/browser/profiles/profile.cc
+++ b/chrome/browser/profiles/profile.cc
@@ -356,7 +356,7 @@ void Profile::RegisterProfilePrefs(user_prefs::PrefRegistrySyncable* registry) {
       media_router::prefs::kMediaRouterEnableCloudServices, false,
       user_prefs::PrefRegistrySyncable::SYNCABLE_PREF);
   registry->RegisterBooleanPref(
-      media_router::prefs::kMediaRouterMediaRemotingEnabled, true);
+      media_router::prefs::kMediaRouterMediaRemotingEnabled, false);
   registry->RegisterListPref(
       media_router::prefs::kMediaRouterTabMirroringSources);
 #endif
diff --git a/chrome/browser/profiles/profile_impl.cc b/chrome/browser/profiles/profile_impl.cc
--- a/chrome/browser/profiles/profile_impl.cc
+++ b/chrome/browser/profiles/profile_impl.cc
@@ -434,7 +434,7 @@ void ProfileImpl::RegisterProfilePrefs(
 #endif
 
   registry->RegisterBooleanPref(prefs::kForceEphemeralProfiles, false);
-  registry->RegisterBooleanPref(prefs::kEnableMediaRouter, true);
+  registry->RegisterBooleanPref(prefs::kEnableMediaRouter, false);
 #if !defined(OS_ANDROID)
   registry->RegisterBooleanPref(prefs::kShowCastIconInToolbar, false);
 #endif  // !defined(OS_ANDROID)
-- 
2.17.1

